<% require_stylesheet 'csv_import' %>
<% require_javascript 'csv_import' %>


<h1 class="page-content corners-top">

  STEP 3: Field Mapping

</h1>

<div class="page-content corners-bottom">

  <div class="csv-container">

    <div class="content">

      <%= form_tag '/contacts/imports/update_csv' do %>
          
      <table>
        <tr>
          <td>

            <table class="csv-table">

               <th class="csv-table">CSV Field</th> <th class="csv-table">Discard</th> <th class="omega-table">Omega Field</th>

                  <% @rows[0].each do |c|%>

                    <% unless c.nil? %>

                      <tr class="csv-table">

                         <td class="csv-table">
                            <%=c%>
                         </td>

                         <td class="csv-table">

                           <% @flag = true %>

                            <% @mapping.each do |k,v| %>

                               <% if v.include?(c) || k == c %>

                                   <% @flag = false %>

                               <%end%>

                            <%end%>

                           <%= check_box "mapping[#{c}]", 'discard', {:checked => @flag} %>

                           <%= hidden_field_tag "mapping[#{c}][column]", @rows[0].index(c)%>


                         </td>

                         <td class="csv-table">

                            <% @val = c %>

                            <% @mapping.each do |k,v| %>

                               <% if v.include?(c) %>

                                   <% @val = k %>

                               

                               <%end%>

                            <%end%>

                            <%= select 'csv_field',c, options_from_collection_for_select(@contact_fields,"name","name",@val) %>
                            <%= hidden_field 'column', @val, :value => @rows[0].index(c)%>

                          </td>
                      </tr>
                    <%end%>

                  <%end%>

            </table>
          </td>

          <td>

            <table class="csv-table">

                  <th class="csv-table">Imported Data Preview</th>

                      <% @rows[1].each do |d| %>

                                 <tr class="csv-table">

                                     <td class="csv-table">
                                         <%=d%>
                                     </td>
                                   
                                 </tr>

                      <%end%>
            </table>

          </td>
        </tr>
        
      </table>

          
      <%= submit_tag "Discard", :name => "update"%>

      <%= submit_tag "Next", :name => "next"%>


      <%end%>
    </div>

  </div>

</div>



















