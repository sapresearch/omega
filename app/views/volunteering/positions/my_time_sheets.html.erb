<% require_javascript 'https://www.google.com/jsapi' %>
<%= context_box do %>
   <div class="page-content circle-corners-bottom  corners-top">
    	
		<div class="heading-main">
			<div class="left-heading">
				<h1 class="page-content">
      				Time Sheets
		    	</h1>
			</div>
		</div>


      <div class="right">
      	<br/>
        <%= om_button(:icon=>'sort-az', :small => true) do %>
            <%= link_to 'sort A-Z', url_for(params.merge(:name => 'asc')) %>
        <% end %>
        <%= om_button(:icon=>'sort-za', :small => true) do %>
            <%= link_to 'sort Z-A', url_for(params.merge(:name => 'desc')) %>
        <% end %>

      </div>
      <div class="clear"></div>
      <% if @timesheets.empty? %>
          <strong>You Don't Have Any Time Sheets Yet!</strong><br/><br/>
      <% else %>
          <% @timesheets.each do |timesheet| %>
                <% timesheet.each do |t| %>
                   <h2><%= Volunteering::Position.find_by_id(Volunteering::Record.find_by_id(t.record_id).position_id).name %></h2>
                   <span class="cf3a72">From: </span> <span class="date"> <%= start = t.week.strftime('%Y-%m-%d') %> </span>
                   <span class="cf3a72">To: </span>   <span class="date">  <%= Date.parse(start).advance(:days => 6).to_time.strftime('%Y-%m-%d') %></span>
                   <% unless t.nil? %>
                        <table class="width-100">
                          <thead>
                          <th class="ui-state-default"></th>
                          <th class="ui-state-default">MON</th>
                          <th class="ui-state-default">TUE</th>
                          <th class="ui-state-default">WED</th>
                          <th class="ui-state-default">THU</th>
                          <th class="ui-state-default">FRI</th>
                          <th class="ui-state-default">SAT</th>
                          <th class="ui-state-default">SUN</th>
                          </thead>
                          <tr class="odd">
                            <td>Hours</td>
                            <% @entry_days.each do |ed| %>
                                <% if t.id == ed.time_entry_id %>
                                    <td><%= ed.hours %></td>
                                <% end %>
                            <% end %>
                          </tr>
                        </table>
                    <% end %>
                <% end %>
	          <%#= om_button(:icon => 'clock') do %>
					<!-- THIS IS ANNE'S SHITTY CODE -->
	          	<%#=  link_to 'Record Hours Now!', new_volunteering_time_entries_path(:id => @record) %>
					<!-- THIS IS ANNE'S SHITTY CODE -->
	      	<%# end %>
          <% end %>
    	<% end %>

		<!-- my changes -->
		<% @records.each do |r| %>
	      <%= om_button(:icon => 'clock') do %>
				<%=  link_to 'Record Hours Now!', new_volunteering_time_entry_path(:id => r.id) %>
			<% end %>
		<% end %>
		<!-- my changes -->
	</div>
<div id="volunteer_charts" style="position: absolute; top: 350px; left: 350px; right: 700px">
  <div id="range_slider_div"></div>
  <div id="pie_chart_div" style="color: #E1DFCB"></div>
</div>
<script type="text/javascript">
  // Load the Visualization API and the controls package.
  google.load('visualization', '1.0', {'packages':['controls']});

  // Set a callback to run when the Google Visualization API is loaded.
  google.setOnLoadCallback(drawDashboard);

  // Callback that creates and populates a data table,
  // instantiates a dashboard, a range slider and a pie chart,
  // passes in the data and draws it.
  function drawDashboard() {

  // Create our data table.
  var data = google.visualization.arrayToDataTable(
    <%= raw  Contact.includes(:records => :position).all.map{
      |c| [c.first_name.to_s, c.records.inject(0) {
          |result,record|
          result += (record.position.end - record.position.start).to_i / 3600
        }]
    }.sort{ |a, b| b[1] <=> a[1] }.insert(0, ['Volunteer', 'Hours per Week'])
    %>
  );

  // Create a dashboard.
  var dashboard = new google.visualization.Dashboard(
      document.getElementById('volunteer_charts'));

  // Create a range slider, passing some options
  var donutRangeSlider = new google.visualization.ControlWrapper({
    'controlType': 'NumberRangeFilter',
    'containerId': 'range_slider_div',
    'options': {
      'filterColumnLabel': 'Hours per Week'
      , 'ui': { 'labelStacking': 'vertical' }
    }
  });

  // Create a pie chart, passing some options
  var pieChart = new google.visualization.ChartWrapper({
    'chartType': 'PieChart',
    'containerId': 'pie_chart_div',
    'options': {
      title: 'Volunteer Contributions (hours)'
      , chartArea: { left: 5, top: 40 }
      , pieSliceText: 'value'
      , is3D: true
      , backgroundColor: {'stroke': '#E2DFCB', 'fill': '#E1DFCB'}
      , chartArea: { left: 30, top: 30, width: 400, height: 400 }
    }
  });

  // Establish dependencies, declaring that 'filter' drives 'pieChart',
  // so that the pie chart will only display entries that are let through
  // given the chosen slider range.
  dashboard.bind(donutRangeSlider, pieChart);

  // Draw the dashboard.
  dashboard.draw(data);
}
</script>
<% end %>
