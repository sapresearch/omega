<%
   ordinals         = t(:'calendar.recurrence.ordinals').map { |k, v| [v, k] }
   days_of_the_week = t(:'calendar.recurrence.days_of_the_week')
   days             = t(:'calendar.recurrence.days').map { |k, v| [v, k] }
   months           = t(:'calendar.recurrence.months').map { |k, v| [v, k] }
%>
    <%= builder.fields_for(:recurrence) do |r| %>
    <fieldset>
        <legend>Time</legend>
        Start: <%= r.text_field :start_time %><br />
        End: <%= r.text_field :end_time %><br />
    </fieldset>

    <fieldset>
        <legend>Recurrence pattern</legend>
        <%= r.radio_button :pattern, Calendar::Recurrence::DAILY %><%= t(:'calendar.recurrence.daily') %><br />
        <%= r.fields_for(:daily) do |d| %>
            <%= d.radio_button :every, Calendar::Recurrence::DAY %>Every <%= d.text_field :days %> day(s)<br />
            <%= d.radio_button :every, Calendar::Recurrence::WEEKDAY %>Every weekday<br />
        <% end %>

        <%= r.radio_button :pattern, Calendar::Recurrence::WEEKLY %><%= t(:'calendar.recurrence.weekly') %><br />
        <%= r.fields_for(:weekly) do |w| %>
            Every <%= w.text_field :weeks %> week(s)<br />
            <%= w.fields_for :days do |wd| %>
                <% days_of_the_week.each do |day, human_day| %>
                    <%= wd.check_box day, :checked => (w.object.days[day] == '1' ? 'checked' : '') %> <%= human_day %>
                <% end %>
            <% end %><br />
        <% end %>

        <%= r.radio_button :pattern, Calendar::Recurrence::MONTHLY %><%= t(:'calendar.recurrence.monthly') %><br />
        <%= r.fields_for(:monthly) do |m| %>
            <%= m.radio_button :every, Calendar::Recurrence::DAY %>Day
            <%= m.fields_for(:day) do |md| %>
                <%= md.text_field :days %> of <%= md.text_field :months %> month(s)<br />
            <% end %>
            <%= m.radio_button :every, Calendar::Recurrence::ORDINAL %>The
            <%= m.fields_for(:ordinal) do |mo| %>
                <%= mo.select :ordinal, ordinals %><%= mo.select :days, days %> of every <%= mo.text_field :months %> month(s)<br />
            <% end %>
        <% end %>

        <%= r.radio_button :pattern, Calendar::Recurrence::YEARLY %><%= t(:'calendar.recurrence.yearly') %><br />
        <%= r.fields_for(:yearly) do |y| %>
            Every <%= y.text_field :years %> year(s)<br />
            <%= y.radio_button :every, Calendar::Recurrence::DAY %>On
            <%= y.fields_for(:day) do |yd| %>
                <%= yd.text_field :months %><%= yd.text_field :days %><br />
            <% end %>
            <%= y.radio_button :every, Calendar::Recurrence::ORDINAL %>On the
            <%= y.fields_for(:ordinal) do |yo| %>
                <%= yo.select :ordinal, ordinals %><%= yo.select :days, days %> of <%= yo.select :months, months %><br />
            <% end %>
        <% end %>
    </fieldset>

    <fieldset>
        <legend>Recurrence range</legend>
        Start: <%= r.text_field :start %><br />
        <%= r.radio_button :end_on, Calendar::Recurrence::END_ON_NEVER %>No end date<br />
        <%= r.radio_button :end_on, Calendar::Recurrence::END_ON_NUMBER %>End after: <%= r.text_field :end_after %> ocurrences<br />
        <%= r.radio_button :end_on, Calendar::Recurrence::END_ON_DATE %>End by: <%= r.text_field :end_at %><br />
    </fieldset>
    <% end %>