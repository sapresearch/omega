<% service = @service if service.nil? %>
<% service_id = service.id unless service.nil? %>
<% services = (@services.nil? ? [] : @services) if services.nil? %>

<script type="text/javascript">
  // global variables for jquery dialog 
  var service_registrations_url = "<%= service_registrations_url %>"

  // parse relative objects to json for client process to avoid ajax
  var services = []
  <% services.each do |s| %>
    services.push(<%= raw s.to_json(:include=>{:service_registration_form=>{:only=>:html}}) %>)
  <% end %>
</script>

      <div id="accordion">
        <% services.each do |s| %>
          <% if(is_admin? || s.is_public?) %>
            <h3 id="service_title_<%= s.id %>" <%= "class='service_leaf'" if s.is_leaf? %> >
              <%= render "services/show_title", :service=>s %>
            </h3>
            <div id="service_body_<%= s.id %>" class="service_body" >
              <%= render "services/show_body", :service=>s %>
            </div>
           <% end %>
        <% end %>
      </div>
      <script type="text/javascript">
        services_accordion('<%= service_id %>');
        $('.service_operation_button').button();
      </script>