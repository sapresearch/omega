<%= render :layout => 'layouts/services_wizard' do %>
    <% logger.debug("\n\n@service = #{@service}") %>
    <%= form_for @service, :action => "service_wizard" do |f| %>
        <%= errors_for_form(@service, 'service') %>


        <h2>
          <%= @service.service_type %>
        </h2>
        <%= f.hidden_field :service_type %>
        <% if @service.icon_file_name != 'missing.png' %>

            <%#= image_tag @service.icon.url(:small), :width =>  '65' %><br/>

        <% else %>

            <%#= image_tag "/images/icons/services/types/default/missing.png", :width =>  '65' %><br/>

        <% end %>
        <%= f.hidden_field :icon %>
        <%= f.hidden_field :published %>
        <p>
          <%= f.label :category %>
          <%= @service.service_category %>
        </p>

        <p>
          <%= f.label :name_for_service %>  <%= f.text_field :service_name %>
        </p>
        <p>
          <%= f.label :description %>
          <%= f.text_area :description, :value => @service.description %>
        </p>

        <% unless @details.empty? %>

            <% @details.each_with_index do |detail, index| %>

                <%= f.fields_for "details_attributes[#{index}]", detail do |ff| %>

                    <%= ff.hidden_field :id %>
                    <%= ff.hidden_field :service_id %>
                    <%= ff.hidden_field :field_id %>



                    <% @field =  Service::Field.find_by_id_and_field_category(detail.field_id, "Service Details") %>

                    <% unless @field.nil? %>

                        <strong><%= @field.field_name %></strong> <%= ff.text_field :field_value %>

                    <% end %>


                <% end %>
            <% end %>
        <% end %>
        <p>
          <%= link_to 'Add Another Service Detail', add_service_field_services_url(:index => @service.fields.size), :remote => true %>
        </p>




        <div id="service_details_fields">


        </div>


        <% unless @service_fields.empty? %>

            <p class="left2">

              <strong>Select Fields You Would Want to Remove</strong>

              <br/><br/>

              <% @service_fields.each_with_index do |d| %>


                  <%= f.fields_for "fields", d do |ff| %>

                      <%= ff.check_box '_destroy' %> <%= d.field_name %>
                      <%= ff.hidden_field :field_name %>
                      <%= ff.hidden_field :field_type %>

                      <br/>

                  <% end %>

              <% end %>

        <% end %>




        <% if @service.service_category.eql?("Enrollable") %>

            <strong> First Name <br/>
              Last Name <br/>
              Email <br/>
              Phone Numbers <br/>
              Notes <br/>
            </strong>


        <% else %>

            <strong>
              Email <br/>
              Phone Numbers <br/>
              Notes <br/>
              Questions <br/>


            </strong>

        <% end %>

        <% unless @registration_fields.empty? %>

            <% @registration_fields.each_with_index do |field, index| %>

                <%= f.fields_for "fields_attributes[#{index}]", field do |ff| %>

                    <%= ff.hidden_field :id %>

                    <%= ff.hidden_field :service_id %>
                    <%= ff.hidden_field :field_category %>

                    <strong><%= field.field_name %> </strong>



                <% end %>
            <% end %>
        <% end %>


        <div id="add_registration_field_link">

          <%= link_to 'Add Registration Form Field', add_registration_field_services_url(:index => @service.fields.size + 1), :remote => true %>

        </div>

        <div id="service_registration_fields">

        </div>

        <% unless @registration_fields.empty? %>

            <p class="left2">

              <strong>Select Fields You Would Want to Remove</strong>

              <br/><br/>

              <% @registration_fields.each_with_index do |d| %>


                  <%= f.fields_for "fields", d do |ff| %>

                      <%= ff.check_box '_destroy' %> <%= d.field_name %>
                      <%= ff.hidden_field :field_name %>
                      <%= ff.hidden_field :field_type %>

                      <br/>

                  <% end %>

              <% end %>

        <% end %>



        <div class="bottom-buttons">

          <%= om_button(:icon=>'back') do %>
              <%= link_to 'Back', service_wizard_services_url(:step => 1) %>
          <% end %>
          <%= om_button(:icon=>'save') do %>
              <%= f.submit "Save", :name => "save" %>
          <% end %>

          <%= om_button(:icon=>'next') do %>
              <%= f.submit "Next", :name => "next" %>
          <% end %>

          <%#= om_button(:icon=>'cancel') do %>
          <%#= link_to 'Cancel', @service, :confirm => 'Do You Want to Quit?', :method => :delete %>
          <%# end %>




    <% end %>
    </div>





<% end %>
<div id="form-builder">

</div>

<% content_for :sidebar do %>
    <%= render :partial => "layouts/sidebar_services_introduction" %>
<% end %>